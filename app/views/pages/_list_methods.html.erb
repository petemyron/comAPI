<h2>API Methods</h2>


<%= form_tag home_path, :method => 'get', :id => "method_search_form" do %>
  <p>
    <%= hidden_field_tag :cp_search, params[:cp_search], :id => "hidden_cp_search" %>
    <%= text_field_tag :search, params[:search] %>
    <%= submit_tag "Search", :name => nil %>
  </p>
<% end %>

<div class="list" id ="method_list">
<% @i = 0 %>
<% @calls.sort_by(&:method_name).each do |call| %>

  <div id ="method_<%= @i %>">
    <h4><%= link_to_function "#{call.method_name}", "my_toggle('method_detail_#{@i}')" %></h4> |
    <%= link_to 'Show', call, :method => :get %> |
    <%= link_to 'Edit', edit_call_path(call), :method => :get %> |

    <% # if the URL doesn't contain "admin=true" then let's not show the 'destroy' button %>
    <% if params[:admin].to_s == "true" %>
      <%= link_to 'Delete', call, :confirm => 'Are you sure?', :method => :delete %> |
    <% end %>

    <%= link_to 'Execute', make_request_path(call), :method => :get %>

    <div class="hidden" id ="method_detail_<%= @i %>">
      <%= field_set_tag "#{call.endpoint_uri}" do -%>
        <div class="xml"><%= call.xml %></div>
      <% end -%>
    </div>

  </div>
  <% @i += 1 %>

<% end %>
</div>

<br />
<%= button_to 'New Call', new_call_path, :method => :get %>
